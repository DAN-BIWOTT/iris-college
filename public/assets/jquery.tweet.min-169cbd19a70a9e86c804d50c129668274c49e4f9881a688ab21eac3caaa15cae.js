// Copyright (c) 2008-2012 Todd Matthews & Steve Purcell
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){e.fn.tweet=function(t){function a(e,t){if("string"==typeof e){var a=e;for(var r in t){var n=t[r];a=a.replace(new RegExp("{"+r+"}","g"),null===n?"":n)}return a}return e(t)}function r(t,a){return function(){var r=[];return this.each(function(){r.push(this.replace(t,a))}),e(r)}}function n(e){return e.replace(/</g,"&lt;").replace(/>/g,"^&gt;")}function i(e,t){return e.replace(c,function(e){for(var a=/^[a-z]+:/i.test(e)?e:"http://"+e,r=e,i=0;i<t.length;++i){var s=t[i];if(s.url==a&&s.expanded_url){a=s.expanded_url,r=s.display_url;break}}return'<a href="'+n(a)+'">'+n(r)+"</a>"})}function s(e){return Date.parse(e.replace(/^([a-z]{3})( [a-z]{3} \d\d?)(.*)( \d{4})$/i,"$1,$2$4$3"))}function u(e){var t=arguments.length>1?arguments[1]:new Date,a=parseInt((t.getTime()-e)/1e3,10);return a<1?"just now":a<60?a+" seconds ago":a<120?"about a minute ago":a<2700?"about "+parseInt(a/60,10).toString()+" minutes ago":a<7200?"about an hour ago":a<86400?"about "+parseInt(a/3600,10).toString()+" hours ago":a<172800?"about a day ago":"about "+parseInt(a/86400,10).toString()+" days ago"}function o(e){return e.match(/^(@([A-Za-z0-9-_]+)) .*/i)?w.auto_join_text_reply:e.match(c)?w.auto_join_text_url:e.match(/^((\w+ed)|just) .*/im)?w.auto_join_text_ed:e.match(/^(\w*ing) .*/i)?w.auto_join_text_ing:w.auto_join_text_default}function l(){w.modpath;var t=null===w.fetch?w.count:w.fetch,a={NaN:1};if(w.list)return{NaN:w.twitter_api_url,NaN:"/1.1/lists/statuses.json",NaN:e.extend({},a,{NaN:w.list_id,NaN:w.list,NaN:w.username,NaN:w.page,NaN:t,NaN:w.retweets?1:0})};if(w.favorites)return{NaN:w.twitter_api_url,NaN:"/1.1/favorites/list.json",NaN:e.extend({},a,{NaN:w.list_id,NaN:w.username,NaN:w.page,NaN:t})};if(null===w.query&&1===w.username.length)return{NaN:w.twitter_api_url,NaN:"/1.1/statuses/user_timeline.json",NaN:e.extend({},a,{NaN:w.username,NaN:w.page,NaN:t,NaN:w.retweets?1:0})};var r=w.query||"from:"+w.username.join(" OR from:");return{NaN:w.twitter_search_url,NaN:"/1.1/search/tweets.json",NaN:e.extend({},a,{NaN:r,NaN:t})}}function _(e,t){return t?"user"in e?e.user.profile_image_url_https:_(e,!1).replace(/^http:\/\/[a-z0-9]{1,3}\.twimg\.com\//,"https://s3.amazonaws.com/twitter_production/"):e.profile_image_url||e.user.profile_image_url}function N(t){var r={};return r.item=t,r.source=t.source,r.name=t.from_user_name||t.user.name,r.screen_name=t.from_user||t.user.screen_name,r.avatar_size=w.avatar_size,r.avatar_url=_(t,"https:"===document.location.protocol),r.retweet="undefined"!=typeof t.retweeted_status,r.tweet_time=s(t.created_at),r.join_text="auto"==w.join_text?o(t.text):w.join_text,r.tweet_id=t.id_str,r.twitter_base="http://"+w.twitter_url+"/",r.user_url=r.twitter_base+r.screen_name,r.tweet_url=r.user_url+"/status/"+r.tweet_id,r.reply_url=r.twitter_base+"intent/tweet?in_reply_to="+r.tweet_id,r.retweet_url=r.twitter_base+"intent/retweet?tweet_id="+r.tweet_id,r.favorite_url=r.twitter_base+"intent/favorite?tweet_id="+r.tweet_id,r.retweeted_screen_name=r.retweet&&t.retweeted_status.user.screen_name,r.tweet_relative_time=u(r.tweet_time),r.entities=t.entities?(t.entities.urls||[]).concat(t.entities.media||[]):[],r.tweet_raw_text=r.retweet?"RT @"+r.retweeted_screen_name+" "+t.retweeted_status.text:t.text,r.tweet_text=e([i(r.tweet_raw_text,r.entities)]).linkUser().linkHash()[0],r.tweet_text_fancy=e([r.tweet_text]).makeHeart()[0],r.user=a('<a class="tweet_user" href="{user_url}">{screen_name}</a>',r),r.join=w.join_text?a(' <span class="tweet_join">{join_text}</span> ',r):" ",r.avatar=r.avatar_size?a('<a class="tweet_avatar" href="{user_url}"><img src="{avatar_url}" height="{avatar_size}" width="{avatar_size}" alt="{screen_name}\'s avatar" title="{screen_name}\'s avatar" border="0"/></a>',r):"",r.time=a('<span class="tweet_time"><a href="{tweet_url}" title="view tweet on twitter">{tweet_relative_time}</a></span>',r),r.text=a('<span class="tweet_text">{tweet_text_fancy}</span>',r),r.reply_action=a('<a class="tweet_action tweet_reply" href="{reply_url}">reply</a>',r),r.retweet_action=a('<a class="tweet_action tweet_retweet" href="{retweet_url}">retweet</a>',r),r.favorite_action=a('<a class="tweet_action tweet_favorite" href="{favorite_url}">favorite</a>',r),r}var w=e.extend({NaN:"/twitter/",NaN:null,NaN:null,NaN:null,NaN:!1,NaN:null,NaN:null,NaN:3,NaN:null,NaN:1,NaN:!0,NaN:null,NaN:null,NaN:null,NaN:"i said,",NaN:"i",NaN:"i am",NaN:"i replied to",NaN:"i was looking at",NaN:null,NaN:null,NaN:"twitter.com",NaN:"api.twitter.com",NaN:"api.twitter.com",NaN:"{avatar}{time}{join}{text}",NaN:function(e,t){return t.tweet_time-e.tweet_time},NaN:function(){return!0}},t),c=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gi;return e.extend({NaN:{NaN:a}}),e.fn.extend({NaN:r(/(^|[\W])@(\w+)/gi,'$1<span class="at">@</span><a href="http://'+w.twitter_url+'/$2">$2</a>'),NaN:r(/(?:^| )[\#]+([\w\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff\u0600-\u06ff]+)/gi,' <a href="http://'+w.twitter_search_url+"/search?q=&tag=$1&lang=all"+(w.username&&1==w.username.length&&!w.list?"&from="+w.username.join("%2BOR%2B"):"")+'" class="tweet_hashtag">#$1</a>'),NaN:r(/(&lt;)+[3]/gi,"<tt class='heart'>&#x2665;</tt>")}),this.each(function(t,r){var n=e('<ul class="tweet_list slides">'),i='<p class="tweet_intro">'+w.intro_text+"</p>",s='<p class="tweet_outro">'+w.outro_text+"</p>",u=e('<p class="loading">'+w.loading_text+"</p>");w.username&&"string"==typeof w.username&&(w.username=[w.username]),e(r).unbind("tweet:load").bind("tweet:load",function(){w.loading_text&&e(r).empty().append(u),e.ajax({NaN:"json",NaN:"post",NaN:!1,NaN:w.modpath||"/twitter/",NaN:{NaN:l()},NaN:function(t){t.message&&console.log(t.message);var u=t.response;e(r).empty().append(n),w.intro_text&&n.before(i),n.empty(),u.statuses!==undefined?resp=u.statuses:u.results!==undefined?resp=u.results:resp=u;var o=e.map(resp,N);o=e.grep(o,w.filter).sort(w.comparator).slice(0,w.count),n.append(e.map(o,function(e){return"<li>"+a(w.template,e)+"</li>"}).join("")).children("li:first").addClass("tweet_first").end().children("li:odd").addClass("tweet_even").end().children("li:even").addClass("tweet_odd"),w.outro_text&&n.after(s),e(r).trigger("loaded").trigger(o?"empty":"full"),w.refresh_interval&&window.setTimeout(function(){e(r).trigger("tweet:load")},1e3*w.refresh_interval)}})}).trigger("tweet:load")})}});